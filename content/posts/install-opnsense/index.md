---
date: 2021-09-09T17:06:40+08:00
title: "å®‰è£ Opnsense ä¸¦è¨­å®š OpenVPN"
description: ""
author: "Yuan"
draft: false
tags: ["vpn","openvpn","pfsense","opnsense"]
keywords: []
categories: ["mis"]
---

## å‰è¨€

ç›®å‰æœ‰äº†åœ¨å¤–é¢å­˜å– NAS è³‡æ–™çš„éœ€æ±‚ï¼Œç›´æ¥è£¸å¥”å¯¦åœ¨ä¸æ˜¯å€‹æ˜æ™ºçš„æƒ³æ³•ã€‚é‚„æ˜¯æ”¾åœ¨é˜²ç«ç‰†å¾Œé¢ï¼Œæ¶å€‹ VPN æœå‹™å¥½äº†ã€‚
æƒ³èªªæ—¢ç„¶è¦æ¶ VPN ä¼ºæœå™¨ã€‚è¶é€™æ¬¡æ©Ÿæœƒä¹Ÿä¸€ä½µæ›å¥—é˜²ç«ç‰†è»Ÿé«”è©¦è©¦ã€‚
<!--more-->

## ä¸»è¦å…§å®¹

### ä¸‹è¼‰æ˜ åƒæª”

é¸æ“‡å¥½æƒ³ä½¿ç”¨çš„æ˜ åƒæª”å¾Œå°±å¯ä»¥ç›´æ¥ä¸‹è¼‰ä¸‹ä¾†ï¼Œæº–å‚™è£½ä½œå®‰è£éš¨èº«ç¢Ÿã€‚

{{< figure src="images/download-page.png" caption="ä¸‹è¼‰é é¢" >}}

```bash
# Image Type: vga
# Mirror: Nantou County Education Network center

wget https://mirror.ntct.edu.tw/opnsense/releases/21.7/OPNsense-21.7.1-OpenSSL-vga-amd64.img.bz2
```

### è£½ä½œå®‰è£éš¨èº«ç¢Ÿ

åœ¨é€™è£¡æˆ‘å€‘ä½¿ç”¨ `dd` ä¾†è£½ä½œå®‰è£éš¨èº«ç¢Ÿã€‚å¦‚æœæ˜¯ä½¿ç”¨ Windows ç³»çµ±çš„åŒå­¸å‰‡å˜—è©¦ä½¿ç”¨ [Rufs](https://rufus.ie/en/) ä¾†è£½ä½œã€‚

```bash
bzcat OPNsense-21.7.1-OpenSSL-vga-amd64.img.bz2|sudo dd of=/dev/${DISK} bs=10m
```

### å®‰è£ Opnsense (åƒè€ƒå½±ç‰‡)

ä½¿ç”¨æˆ‘å€‘å‰›è£½ä½œå®Œæˆçš„ Opnsense å®‰è£éš¨èº«ç¢Ÿé–‹æ©Ÿå¾Œä½¿ç”¨ installer/opnsense å¸³æˆ¶ç™»å…¥ï¼Œä¾¿å¯ä»¥é–‹ä½¿é€²è¡Œå®‰è£ã€‚
ä¸‹åˆ—æ•´ç†äº†å®‰è£çš„æ­¥é©Ÿ

1. å®‰è£ Opnsense ç³»çµ±
2. é…ç½® WAN
3. é…ç½® LAN
4. é…ç½®æˆ‘å€‘æ‰€éœ€è¦çš„é˜²ç«ç‰†è¦å‰‡

{{< youtube doFZiJrBnek >}}

### è¨­å®š OpenVPN (åƒè€ƒå½±ç‰‡)

ä¸‹åˆ—æ•´ç†äº†è¦æ¶è¨­ OpenVPN çš„æ­¥é©Ÿ
1. å»ºç«‹ Root CA
2. å»ºç«‹ VPN ä¼ºæœå™¨æ‰€è¦ä½¿ç”¨çš„æ†‘è­‰ ( Server-Cert )
3. å»ºç«‹æœ¬æ©Ÿç”¨æˆ¶æ‰€è¦ä½¿ç”¨çš„æ†‘è­‰ ( User-Cert )
4. å»ºç«‹ OpenVPN Serverï¼Œä¸¦æ·»åŠ é˜²ç«ç‰†è¦å‰‡
5. åŒ¯å‡º OpenVPN ä½¿ç”¨è€…ç«¯çš„è¨­å®šæª”
6. æœ€å¾Œï¼Œåœ¨çµ‚ç«¯è¨­å‚™å®‰è£ OpenVPN ä½¿ç”¨è€…ç¨‹å¼ä¸¦åŒ¯å…¥è¨­å®šæª”(*.ovpn)ã€‚

{{< youtube ocGAcZD8qYo >}}

## å°çµ

åŸæœ¬ç­†è€…æ˜¯ä½¿ç”¨ pfSense é€™å¥—é˜²ç«ç‰†ï¼Œæ‰€ä»¥åœ¨é…ç½®ä¸Šå…¶å¯¦ Opnsense èˆ‡ pfSense å·®ç•°æ²’æœ‰å¾ˆå¤§ã€‚
ä¸éå¤–è§€ç¢ºå¯¦è®Šå¾—æ¯”è¼ƒæ¼‚äº®äº†ğŸ¤£ã€‚


## åƒè€ƒé€£çµ

- [å®˜æ–¹ç¶²ç«™][1]
- [å®˜æ–¹æ–‡ä»¶][2]

[1]:https://opnsense.org
[2]:https://docs.opnsense.org/setup.html
